# æœåŠ¡å™¨é…ç½®è¯´æ˜

## ğŸ¯ ç”Ÿäº§ç¯å¢ƒé…ç½®

### æœåŠ¡å™¨ä¿¡æ¯
- **æœåŠ¡å™¨ IP**: `47.252.36.81`
- **Suno API Key**: `28f61cf2a6012f2a1204f8569768f979`

### æœåŠ¡åœ°å€
- **ä¸»æœåŠ¡**: `http://47.252.36.81:3001`
- **æ–‡ä»¶æœåŠ¡å™¨**: `http://47.252.36.81:8081`
- **å¥åº·æ£€æŸ¥**: `http://47.252.36.81:3001/health`

### ç«¯å£é…ç½®
- **ä¸»æœåŠ¡ç«¯å£**: `3001`
- **æ–‡ä»¶æœåŠ¡å™¨ç«¯å£**: `8081`

---

## ğŸ“¦ éƒ¨ç½²æ­¥éª¤

### 1. ä¸Šä¼ åˆ°æœåŠ¡å™¨

```bash
# åœ¨æœ¬åœ°æ‰“åŒ…
cd C:\work\ai_music
tar -czf ai_music_service.tar.gz ai_music_service_deploy/

# ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp ai_music_service.tar.gz root@47.252.36.81:/root/

# æˆ–ä½¿ç”¨ FTP/SFTP å·¥å…·ä¸Šä¼ 
```

### 2. æœåŠ¡å™¨ä¸Šè§£å‹

```bash
# SSH ç™»å½•æœåŠ¡å™¨
ssh root@47.252.36.81

# è§£å‹
cd /root
tar -xzf ai_music_service.tar.gz
cd ai_music_service_deploy
```

### 3. å®‰è£…ä¾èµ–

```bash
# å®‰è£… Node.jsï¼ˆå¦‚æœæœªå®‰è£…ï¼‰
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# æˆ–ä½¿ç”¨ yumï¼ˆCentOS/RHELï¼‰
curl -fsSL https://rpm.nodesource.com/setup_18.x | sudo bash -
sudo yum install -y nodejs

# å®‰è£…é¡¹ç›®ä¾èµ–
npm install --production
```

### 4. é…ç½®ç¯å¢ƒå˜é‡

**ç¯å¢ƒå˜é‡å·²é¢„é…ç½®å¥½ï¼Œæ— éœ€ä¿®æ”¹ï¼**

æŸ¥çœ‹é…ç½®ï¼š
```bash
cat .env
```

åº”è¯¥çœ‹åˆ°ï¼š
```bash
SUNO_API_KEY=28f61cf2a6012f2a1204f8569768f979
CALLBACK_BASE_URL=http://47.252.36.81:8081
PORT=3001
FILE_SERVER_PORT=8081
```

### 5. é…ç½®é˜²ç«å¢™

```bash
# Ubuntu/Debian
sudo ufw allow 3001/tcp
sudo ufw allow 8081/tcp
sudo ufw reload

# CentOS/RHEL
sudo firewall-cmd --permanent --add-port=3001/tcp
sudo firewall-cmd --permanent --add-port=8081/tcp
sudo firewall-cmd --reload

# é˜¿é‡Œäº‘/è…¾è®¯äº‘
# éœ€è¦åœ¨æ§åˆ¶å°çš„å®‰å…¨ç»„ä¸­å¼€æ”¾ 3001 å’Œ 8081 ç«¯å£
```

### 6. å¯åŠ¨æœåŠ¡

```bash
# ä½¿ç”¨ PM2 å¯åŠ¨ï¼ˆæ¨èï¼‰
npm run pm2:start

# æŸ¥çœ‹çŠ¶æ€
npm run pm2:status

# æŸ¥çœ‹æ—¥å¿—
npm run pm2:logs
```

---

## âœ… éªŒè¯éƒ¨ç½²

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# åœ¨æœåŠ¡å™¨ä¸Š
curl http://localhost:3001/health

# åœ¨æœ¬åœ°æˆ–å…¶ä»–æœºå™¨ä¸Š
curl http://47.252.36.81:3001/health
```

**æœŸæœ›å“åº”**:
```json
{
  "status": "ok",
  "timestamp": "2025-11-13T10:00:00.000Z",
  "uptime": 100
}
```

### 2. æµ‹è¯•æ¥å£

```bash
# æµ‹è¯•ç”Ÿæˆæ­Œè¯
curl -X POST http://47.252.36.81:3001/api/music/generate-lyrics \
  -H "Content-Type: application/json" \
  -d '{"prompt": "ä¸€é¦–å…³äºæµ‹è¯•çš„æ­Œ"}'
```

### 3. è¿è¡Œå®Œæ•´æµ‹è¯•

```bash
# åœ¨æœåŠ¡å™¨ä¸Š
cd /root/ai_music_service_deploy
node test-complete.js
```

---

## ğŸ”§ æ—¥å¸¸ç»´æŠ¤

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€
```bash
npm run pm2:status
```

### æŸ¥çœ‹æ—¥å¿—
```bash
# å®æ—¶æ—¥å¿—
npm run pm2:logs

# æŸ¥çœ‹æ–‡ä»¶æ—¥å¿—
tail -f logs/combined.log
tail -f logs/error.log
```

### é‡å¯æœåŠ¡
```bash
npm run pm2:restart
```

### åœæ­¢æœåŠ¡
```bash
npm run pm2:stop
```

### æ›´æ–°ä»£ç 
```bash
# åœæ­¢æœåŠ¡
npm run pm2:stop

# æ‹‰å–æ–°ä»£ç æˆ–ä¸Šä¼ æ–°æ–‡ä»¶
# ...

# é‡æ–°å®‰è£…ä¾èµ–ï¼ˆå¦‚æœ package.json æœ‰å˜åŒ–ï¼‰
npm install --production

# å¯åŠ¨æœåŠ¡
npm run pm2:start
```

---

## ğŸŒ è®¿é—®åœ°å€

### API æ¥å£
æ‰€æœ‰æ¥å£éƒ½ä½¿ç”¨ `http://47.252.36.81:3001` ä½œä¸ºåŸºç¡€åœ°å€

**ç¤ºä¾‹**:
- å¥åº·æ£€æŸ¥: `http://47.252.36.81:3001/health`
- ç”Ÿæˆæ­Œè¯: `http://47.252.36.81:3001/api/music/generate-lyrics`
- ç”ŸæˆéŸ³ä¹: `http://47.252.36.81:3001/api/music/generate`
- ä¸Šä¼ æ–‡ä»¶: `http://47.252.36.81:3001/api/upload/audio`

### æ–‡ä»¶è®¿é—®
ä¸Šä¼ çš„éŸ³é¢‘æ–‡ä»¶é€šè¿‡ `http://47.252.36.81:8081` è®¿é—®

**ç¤ºä¾‹**:
- æ–‡ä»¶åˆ—è¡¨: `http://47.252.36.81:8081/list`
- éŸ³é¢‘æ–‡ä»¶: `http://47.252.36.81:8081/uploads/audio-xxx.mp3`

---

## ğŸ“ æ³¨æ„äº‹é¡¹

### 1. å®‰å…¨ç»„é…ç½®
ç¡®ä¿äº‘æœåŠ¡å™¨çš„å®‰å…¨ç»„å·²å¼€æ”¾ä»¥ä¸‹ç«¯å£ï¼š
- `3001` - ä¸»æœåŠ¡
- `8081` - æ–‡ä»¶æœåŠ¡å™¨

### 2. å›è°ƒåœ°å€
å½“å‰é…ç½®çš„å›è°ƒåœ°å€æ˜¯ `http://47.252.36.81:8081`ï¼ŒSuno API ä¼šå‘è¿™ä¸ªåœ°å€å‘é€å›è°ƒé€šçŸ¥ã€‚

### 3. æ–‡ä»¶å­˜å‚¨
- ä¸Šä¼ çš„æ–‡ä»¶å­˜å‚¨åœ¨ `./uploads` ç›®å½•
- ä»»åŠ¡æ•°æ®å­˜å‚¨åœ¨ `./data/tasks.json`
- æ—¥å¿—æ–‡ä»¶å­˜å‚¨åœ¨ `./logs` ç›®å½•

### 4. å®šæœŸæ¸…ç†
å»ºè®®å®šæœŸæ¸…ç†æ—§çš„ä¸Šä¼ æ–‡ä»¶å’Œæ—¥å¿—ï¼š
```bash
# æ¸…ç† 7 å¤©å‰çš„ä¸Šä¼ æ–‡ä»¶
find ./uploads -type f -mtime +7 -delete

# æ¸…ç†æ—§æ—¥å¿—ï¼ˆPM2 ä¼šè‡ªåŠ¨è½®è½¬ï¼‰
pm2 flush
```

---

## ğŸ†˜ æ•…éšœæ’æŸ¥

### æœåŠ¡æ— æ³•å¯åŠ¨
```bash
# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
cat logs/error.log

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep 3001
netstat -tlnp | grep 8081

# æ€æ­»å ç”¨ç«¯å£çš„è¿›ç¨‹
kill -9 <PID>
```

### æ— æ³•è®¿é—®æœåŠ¡
1. æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ç«¯å£
2. æ£€æŸ¥äº‘æœåŠ¡å™¨å®‰å…¨ç»„é…ç½®
3. æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š`npm run pm2:status`

### å›è°ƒä¸å·¥ä½œ
1. ç¡®è®¤æœåŠ¡å™¨ IP å¯ä»¥ä»å¤–ç½‘è®¿é—®
2. ç¡®è®¤ 8081 ç«¯å£å·²å¼€æ”¾
3. æ£€æŸ¥ `.env` ä¸­çš„ `CALLBACK_BASE_URL` é…ç½®

---

**é…ç½®å®Œæˆæ—¶é—´**: 2025-11-13  
**æœåŠ¡å™¨ IP**: 47.252.36.81  
**çŠ¶æ€**: âœ… å·²é…ç½®å®Œæˆï¼Œå¯ç›´æ¥éƒ¨ç½²

