# AI éŸ³ä¹æœåŠ¡ v2.0 éƒ¨ç½²å’Œæµ‹è¯•æŒ‡å—

## ğŸ“¦ éƒ¨ç½²å‰å‡†å¤‡

### 1. ç¡®è®¤ç¯å¢ƒ
```bash
node --version  # éœ€è¦ Node.js 14+
npm --version
pm2 --version   # å¦‚æœæ²¡æœ‰å®‰è£…: npm install -g pm2
```

### 2. æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§
ç¡®ä¿ä»¥ä¸‹æ–°æ–‡ä»¶å­˜åœ¨ï¼š
- âœ… `types/task.js` - ä»»åŠ¡ç±»å‹å®šä¹‰
- âœ… `services/taskManager.js` - ä»»åŠ¡ç®¡ç†å™¨
- âœ… `services/ossService.js` - OSSä¸Šä¼ æœåŠ¡
- âœ… `services/callbackService.js` - å›è°ƒæœåŠ¡
- âœ… `å‡çº§è¯´æ˜.md` - å‡çº§æ–‡æ¡£

### 3. å®‰è£…ä¾èµ–
```bash
cd C:\work\ai_music\ai_music_service_deploy
npm install
```

ç¡®è®¤æ–°ä¾èµ–å·²å®‰è£…ï¼š
```bash
npm list p-queue
npm list uuid
```

---

## âš™ï¸ é…ç½®ç¯å¢ƒå˜é‡

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œç¡®ä¿åŒ…å«ä»¥ä¸‹é…ç½®ï¼š

```bash
# Suno API é…ç½®
SUNO_API_KEY=28f61cf2a6012f2a1204f8569768f979
SUNO_API_BASE_URL=https://api.sunoapi.org/api/v1

# æœåŠ¡é…ç½®
PORT=3001
FILE_SERVER_PORT=8081
CALLBACK_BASE_URL=http://47.252.36.81:3001

# ä»»åŠ¡ç®¡ç†å™¨é…ç½®
MAX_CONCURRENCY=10
MAX_QUEUE_SIZE=2500

# OSS é…ç½®
OSS_SIGNED_URL_API=https://ai.mediaio.net/api/v1/ai/signed-upload-url
OSS_UPLOAD_TIMEOUT=60000

# å›è°ƒé…ç½®
CALLBACK_TIMEOUT=10000

# ä¸´æ—¶æ–‡ä»¶ç›®å½•
TEMP_DIR=./temp_audio

# ç¯å¢ƒé…ç½®
NODE_ENV=production
LOG_LEVEL=info
```

---

## ğŸš€ å¯åŠ¨æœåŠ¡

### æ–¹å¼ 1: ä½¿ç”¨ PM2ï¼ˆæ¨èï¼‰
```bash
# åœæ­¢æ—§æœåŠ¡
pm2 stop ecosystem.config.js

# å¯åŠ¨æ–°æœåŠ¡
pm2 start ecosystem.config.js

# æŸ¥çœ‹æ—¥å¿—
pm2 logs

# æŸ¥çœ‹çŠ¶æ€
pm2 status
```

### æ–¹å¼ 2: ç›´æ¥å¯åŠ¨
```bash
node index.js
```

---

## âœ… éªŒè¯éƒ¨ç½²

### 1. æ£€æŸ¥æœåŠ¡å¯åŠ¨
```bash
# æŸ¥çœ‹æ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
# ğŸµ AI éŸ³ä¹æœåŠ¡å·²å¯åŠ¨ (v2.0)
# âš™ï¸  ä»»åŠ¡ç®¡ç†å™¨: å¹¶å‘=10, é˜Ÿåˆ—=2500
pm2 logs ai-music-service
```

### 2. æµ‹è¯•åŸºç¡€æ¥å£
```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:3001/health

# æœåŠ¡ä¿¡æ¯ï¼ˆåº”è¯¥æ˜¾ç¤º v2.0 å’Œä»»åŠ¡ç®¡ç†å™¨çŠ¶æ€ï¼‰
curl http://localhost:3001/

# ä»»åŠ¡ç»Ÿè®¡
curl http://localhost:3001/api/music/stats
```

### 3. è¿è¡Œæµ‹è¯•è„šæœ¬
```bash
node test-api.js
```

é¢„æœŸè¾“å‡ºï¼š
```
========================================
  AI éŸ³ä¹æœåŠ¡ v2.0 - API æµ‹è¯•
========================================

âœ“ æµ‹è¯• 1: å¥åº·æ£€æŸ¥...
  âœ… é€šè¿‡

âœ“ æµ‹è¯• 2: è·å–æœåŠ¡ä¿¡æ¯...
  âœ… é€šè¿‡ - AI éŸ³ä¹ç”ŸæˆæœåŠ¡ 2.0.0
  ä»»åŠ¡ç®¡ç†å™¨çŠ¶æ€: {"total":0,"pending":0,"processing":0,"completed":0,"failed":0}

âœ“ æµ‹è¯• 3: è·å–ä»»åŠ¡ç»Ÿè®¡...
  âœ… é€šè¿‡ - æ€»ä»»åŠ¡: 0, å¤„ç†ä¸­: 0, å·²å®Œæˆ: 0
```

---

## ğŸ§ª åŠŸèƒ½æµ‹è¯•

### æµ‹è¯• 1: ç”Ÿæˆæ­Œè¯ï¼ˆå¼‚æ­¥ï¼‰

**è¯·æ±‚ï¼š**
```bash
curl -X POST http://localhost:3001/api/music/generate-lyrics \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": "å†™ä¸€é¦–å…³äºæ˜¥å¤©çš„æ­Œ",
    "callbackUrl": "https://your-backend.com/api/callback/lyrics"
  }'
```

**é¢„æœŸå“åº”ï¼ˆ202ï¼‰ï¼š**
```json
{
  "code": 202,
  "msg": "Task created successfully",
  "data": {
    "taskId": "uuid-here",
    "status": "pending",
    "progress": 0
  }
}
```

**æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€ï¼š**
```bash
curl http://localhost:3001/api/music/task/{taskId}
```

---

### æµ‹è¯• 2: ç”ŸæˆéŸ³ä¹ï¼ˆå¼‚æ­¥ï¼‰

**è¯·æ±‚ï¼š**
```bash
curl -X POST http://localhost:3001/api/music/generate \
  -H "Content-Type: application/json" \
  -d '{
    "model": "chirp-v3-5",
    "prompt": "ä¸€é¦–è½»å¿«çš„æµè¡ŒéŸ³ä¹",
    "title": "æµ‹è¯•éŸ³ä¹",
    "tags": "æµè¡Œ,è½»å¿«",
    "callbackUrl": "https://your-backend.com/api/callback/music"
  }'
```

**é¢„æœŸå“åº”ï¼ˆ202ï¼‰ï¼š**
```json
{
  "code": 202,
  "msg": "Task created successfully",
  "data": {
    "taskId": "uuid-here",
    "status": "pending",
    "progress": 0
  }
}
```

---

## ğŸ“Š ç›‘æ§å’Œè°ƒè¯•

### æŸ¥çœ‹ä»»åŠ¡ç»Ÿè®¡
```bash
curl http://localhost:3001/api/music/stats
```

### æŸ¥çœ‹æ—¥å¿—
```bash
# PM2 æ—¥å¿—
pm2 logs ai-music-service

# æ–‡ä»¶æ—¥å¿—
tail -f logs/combined.log
tail -f logs/error.log
```

### å¸¸è§é—®é¢˜

**1. ä»»åŠ¡ä¸€ç›´å¤„äº pending çŠ¶æ€**
- æ£€æŸ¥ Suno API æ˜¯å¦æ­£å¸¸
- æŸ¥çœ‹æ—¥å¿—ä¸­æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

**2. OSS ä¸Šä¼ å¤±è´¥**
- æ£€æŸ¥ `OSS_SIGNED_URL_API` é…ç½®
- æµ‹è¯•ç­¾å URL æ˜¯å¦å¯ç”¨

**3. å›è°ƒå¤±è´¥**
- æ£€æŸ¥ `callbackUrl` æ˜¯å¦å¯è®¿é—®
- æŸ¥çœ‹å›è°ƒæ—¥å¿—

---

## ğŸ”„ å›æ»šæ–¹æ¡ˆ

å¦‚æœæ–°ç‰ˆæœ¬æœ‰é—®é¢˜ï¼Œå¯ä»¥å›æ»šåˆ°æ—§ç‰ˆæœ¬ï¼š

```bash
# 1. åœæ­¢æœåŠ¡
pm2 stop ecosystem.config.js

# 2. æ¢å¤æ—§ç‰ˆæœ¬æ–‡ä»¶ï¼ˆå¦‚æœæœ‰å¤‡ä»½ï¼‰
# æˆ–è€…ä½¿ç”¨ git å›æ»š

# 3. é‡æ–°å¯åŠ¨
pm2 start ecosystem.config.js
```

---

## ğŸ“ ä¸‹ä¸€æ­¥

1. âœ… éªŒè¯æ‰€æœ‰æ¥å£æ­£å¸¸å·¥ä½œ
2. âœ… é…ç½®åç«¯çš„å›è°ƒæ¥å£
3. âœ… æµ‹è¯•å®Œæ•´çš„å·¥ä½œæµç¨‹
4. âœ… ç›‘æ§ä»»åŠ¡é˜Ÿåˆ—çŠ¶æ€
5. âœ… æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´å¹¶å‘æ•°

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- `å‡çº§è¯´æ˜.md` - è¯¦ç»†çš„å‡çº§è¯´æ˜
- `logs/combined.log` - å®Œæ•´æ—¥å¿—
- `logs/error.log` - é”™è¯¯æ—¥å¿—

